<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Chat - <%= @month.month %> <%= @month.year %></h5>
          <%= link_to "Voltar ao mês", month_path(@month), class: "btn btn-outline-secondary btn-sm" %>
        </div>

        <div class="card-body" style="height: 400px; overflow-y: auto;" id="chat-messages">
          <% if @messages.empty? %>
            <p class="text-muted text-center">Nenhuma mensagem ainda. Comece a conversa!</p>
          <% else %>
            <% @messages.each do |message| %>
              <div class="mb-3 <%= message.role == 'user' ? 'text-end' : '' %>">
                <div class="d-inline-block p-2 rounded <%= message.role == 'user' ? 'bg-primary text-white' : 'bg-light' %>" style="max-width: 80%;">
                  <small class="d-block fw-bold"><%= message.role == 'user' ? 'Você' : 'Assistente' %></small>
                  <%= simple_format(message.content) %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>

        <div class="card-footer">
          <%= form_with url: month_chat_messages_path(@month, @chat), method: :post, local: true, class: "d-flex gap-2" do |f| %>
            <input type="text" name="message[content]" class="form-control" placeholder="Digite sua pergunta..." required autofocus>
            <button type="submit" class="btn btn-primary">Enviar</button>
          <% end %>
        </div>
      </div>

      <div class="mt-3">
        <div class="card">
          <div class="card-header">
            <small class="text-muted">Contexto do mês</small>
          </div>
          <div class="card-body">
            <p class="mb-0"><%= @month.overview.presence || "Nenhum resumo cadastrado para este mês." %></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
